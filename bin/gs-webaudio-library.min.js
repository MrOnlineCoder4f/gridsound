"use strict";function gswaSampleGroup(){this.samples=[],this.samplesRev=[],this.updateDuration()}!function(){function t(t){this.bufferSources.splice(this.bufferSources.indexOf(t),1)}window.gswaBufferSample=function(){this.bufferSources=[]},gswaBufferSample.prototype={setContext:function(t){this.ctx=t},setMetadata:function(t){t&&(this.duration=this.duration||t.duration)},setDataFromAudioBuffer:function(t){return this.buffer=t,this.setMetadata(t),t},setDataFromArrayBuffer:function(t){return this.ctx.decodeAudioData(t).then(this.setDataFromAudioBuffer.bind(this))},setDataFromBlob:function(t){var e=this,n=new FileReader;return new Promise(function(s,i){n.onloadend=function(){s(e.setDataFromArrayBuffer(n.result))},n.readAsArrayBuffer(t)})},setDataFromURL:function(t){return fetch(t).then(function(t){return t.arrayBuffer()}).then(this.setDataFromArrayBuffer.bind(this))},connect:function(t){this.connectedTo=t,this.bufferSources.forEach(function(e){e.connect(t)})},disconnect:function(){this.connectedTo=null,this.bufferSources.forEach(function(t){t.disconnect()})},start:function(e,n,s){var i,a=this.ctx,r=this.buffer;if(a&&r)return i=a.createBufferSource(),i.buffer=r,i.onended=t.bind(this,i),i.connect(this.connectedTo),this.bufferSources.push(i),i.start(e||0,n||0,arguments.length>2?s:this.duration),i},stop:function(){this.bufferSources.forEach(function(t){t.onended=null,t.stop()}),this.bufferSources.length=0}}}(),function(){function t(t,e){for(var n=0,s=0,i=t.length+e.length,a=new Float32Array(i);n<i;)a[n++]=t[s],a[n++]=e[s++];return a}function e(t,e,n){for(var s=0;s<n.length;++s)t.setUint8(e+s,n.charCodeAt(s))}function n(t,e,n){for(var s,i=0;i<n.length;++i,e+=2)s=Math.max(-1,Math.min(n[i],1)),t.setInt16(e,s<0?32768*s:32767*s,!0)}function s(t,e,n){for(var s=0;s<n.length;++s,e+=4)t.setFloat32(e,n[s],!0)}window.gswaEncodeWAV=function(i,a){var r=i.numberOfChannels,o=i.sampleRate,u=a&&a.float32?3:1,f=3===u?32:16,h=f/8,c=r*h,l=2===r?t(i.getChannelData(0),i.getChannelData(1)):i.getChannelData(0),d=new ArrayBuffer(44+l.length*h),p=new DataView(d);return e(p,0,"RIFF"),p.setUint32(4,36+l.length*h,!0),e(p,8,"WAVE"),e(p,12,"fmt "),p.setUint32(16,16,!0),p.setUint16(20,u,!0),p.setUint16(22,r,!0),p.setUint32(24,o,!0),p.setUint32(28,o*c,!0),p.setUint16(32,c,!0),p.setUint16(34,f,!0),e(p,36,"data"),p.setUint32(40,l.length*h,!0),(1===u?n:s)(p,44,l),d}}(),gswaSampleGroup.prototype={stretch:function(t){this.samples.forEach(function(e){e.whenRel*=t}),this.updateDuration()},start:function(t,e,n){var s=this.samples[0];s&&(e=e||0,n=arguments.length>2?n:this.duration,t||(t=s.sample.ctx.currentTime),this.samples.forEach(function(s){var i=s.whenRel-e,a=s.duration,r=s.offset;i<0&&(r-=i,a+=i),a>0&&(a+=Math.min(n-i-a,0),a>0&&s.sample.start(t+i,r,a))}))},stop:function(){this.samples.forEach(function(t){t.sample.stop()})},addSample:function(t){t.offset=t.offset||0,t.duration=t.duration||t.sample.duration,this.samples.push(t),this.samplesRev.push(t)},addSamples:function(t){t.forEach(this.addSample.bind(this))},removeSample:function(t){this.samples.splice(this.samples.indexOf(t),1),this.samplesRev.splice(this.samplesRev.indexOf(t),1)},removeSamples:function(t){t.forEach(this.removeSample.bind(this))},updateDuration:function(){var t=this.samplesRev[0];this.duration=t?t.whenRel+t.duration:0},sortSamples:function(){function t(t,e){return t<e?-1:t>e?1:0}this.samples.sort(function(e,n){return t(e.whenRel,n.whenRel)}),this.samplesRev.sort(function(e,n){return t(n.whenRel+n.duration,e.whenRel+e.duration)})}};